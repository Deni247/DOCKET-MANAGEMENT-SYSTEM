<!DOCTYPE html>
<html>
<head>
  <title>Dockets</title>
  <link rel="stylesheet" href="dashboard.css">
</head>
<body>
  <div class="sidebar">
    <a href="dashboard.html">Home</a>
    <a href="dockets.html" class="active">Dockets</a>
    <a href="payments.html">Payments</a>
    <a href="results.html">Results</a>
  </div>

  <div class="header">
    <img src="cavendish-logo.png" alt="Cavendish Logo" class="logo">
    <h1>Dockets</h1>
    <a href="dashboard.html"><button class="logout">Back</button></a>
  </div>

  <div class="main">
    <h2>Your Exam Dockets</h2>
    <div id="docketSection">Loading eligibility...</div>
  </div>

<script>
async function loadDockets() {
  const student_id = localStorage.getItem("student_id");
  if (!student_id) {
    document.getElementById("docketSection").innerText = "No student session found.";
    return;
  }

  try {
    const res = await fetch(`http://127.0.0.1:5000/dockets/eligibility/${student_id}`);
    console.log('Response:', res);
    const json = await res.json();
    console.log('JSON:', json);

    if (!json.ok) {
      document.getElementById("docketSection").innerText = json.error || "Error fetching eligibility.";
      return;
    }

    let html = "<table border='1' cellpadding='10'><tr><th>Exam Type</th><th>Status</th><th>Action</th></tr>";
    json.eligibility.forEach(e => {
      const btn = e.eligible
        ? `<button onclick="printDocket('${e.exam_type}')">Print</button>`
        : `<span style='color:red'>Please visit Retentions Office</span>`;
      html += `<tr><td>${e.exam_type}</td><td>${e.eligible ? "Eligible" : "Not Eligible"}</td><td>${btn}</td></tr>`;
    });
    html += "</table>";
    document.getElementById("docketSection").innerHTML = html;
  } catch (error) {
    console.error('Error fetching dockets:', error);
    document.getElementById("docketSection").innerText = "An error occurred while fetching dockets. Please check the console for details.";
  }
}

async function printDocket(exam_type) {
  const student_id = localStorage.getItem("student_id");
  if (!student_id) {
    alert("No student session found.");
    return;
  }
  
  // Open the preview page in a new tab
  const previewUrl = `docket-preview.html?student_id=${student_id}&exam_type=${exam_type}`;
  window.open(previewUrl, '_blank');
}

loadDockets();
</script>
</body>
</html>

